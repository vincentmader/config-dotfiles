#!/bin/sh

echo "ZSHENV"

# -----------------------------------------------------------------------------
# 			        $CONF/zsh/zshenv
# -----------------------------------------------------------------------------

# XDG_CONFIG_HOME="$HOME/.config"
# XDG_CACHE_HOME="$HOME/.cache"
# XDG_DATA_HOME="$HOME/.local/share"

# =============================================================================

if [[ "$OSTYPE" == "darwin"* ]]; then
    USERS="/Users"
elif [[ "$OSTYPE" == "linux"* ]]; then
    USERS="/home"
fi

# =============================================================================

# user, home, conf
export USER=$(whoami)
export HOME="$USERS/$USER"
export CONF="$HOME/.config"
export CDPATH=".:$CONF/symlinks"
# zsh
# export ZDOTDIR="$CONF/zsh"
export ZSH="$CONF/zsh/oh-my-zsh"
export ZSHRC="$CONF/zsh/zshrc"
export ZSH_COMPDUMP="$HOME/.cache/zsh/zcompdump"
export SHELL_SESSIONS_DISABLE=1
# editor
if [[ -n $SSH_CONNECTION ]]; then
  export EDITOR="vim"
else
  export EDITOR="nvim -u $CONF/nvim/init.vim"
fi
export VISUAL="$EDITOR"
export NVIMRC="$CONF/nvim/init.vim"
# locale
export LC_CTYPE=en_US.UTF-8
export LC_ALL=en_US.UTF-8
# history
export HISTSIZE=10000
export SAVEHIST=5000
export HISTFILE="$HOME/.cache/zsh/history"
# python
export PYTHONSTARTUP="$CONF/python/.pythonrc"
export MPLCONFIGDIR="$CONF/matplotlib"
export IPYTHONDIR="$HOME/.local/share/jupyter"
export JUPYTER_CONFIG_DIR="$HOME/.local/share/jupyter"
# node
export NODE_REPL_HISTORY="$HOME/.cache/node_repl_history"
export NODE_REPL_HISTORY_SIZE=10000
# rust
export CARGO_HOME="$HOME/.cache/cargo"
export RUSTUP_HOME="$HOME/.cache/rustup"
# node
export NPM_CONFIG_USERCONFIG="$CONF/npm/npmrc"
# go
export GOPATH="$HOME/.cache/go"
# gpg
export GNUPGHOME="$HOME/.cache/gnupg"
# less
export LESSHISTFILE="$HOME/.cache/lesshst"

# postgresql
# export PSQLRC="$XDG_CONFIG_HOME/pg/psqlrc"
# export PSQL_HISTORY="$XDG_STATE_HOME/psql_history"
# export PGPASSFILE="$XDG_CONFIG_HOME/pg/pgpass"
# export PGSERVICEFILE="$XDG_CONFIG_HOME/pg/pg_service.conf"
# taskwarrior
# export TASKRC="$CONF/taskwarrior/taskrc"
# export TIMEWARRIORDB="$HOME/gtd/timewarrior"
# export WIKI="~/"

# path
export PATH="$PATH:$HOME/.local/bin"  # added when installing virtualenv
export PATH="$PATH:$CARGO_HOME/bin"

# =============================================================================

# database
# -----------------------------------------------------------------------------

if [[ "$OSTYPE" == "darwin"* ]]; then
    # postgresql
    export PATH="$PATH:/Applications/Postgres.app/Contents/Versions/latest/bin"
        # export PATH="/opt/homebrew/opt/libpq/bin:$PATH"
        # export LDFLAGS="-L/opt/homebrew/opt/libpq/lib"
        # export CPPFLAGS="-I/opt/homebrew/opt/libpq/include"
        # export PKG_CONFIG_PATH="/opt/homebrew/opt/libpq/lib/pkgconfig"

    # mysql
    export PATH=$PATH:/Applications/MySQLWorkbench.app/Contents/MacOS
        # export PATH="/opt/homebrew/opt/mysql-client/bin:$PATH"
        # export LDFLAGS="-L/opt/homebrew/opt/mysql-client/lib"
        # export CPPFLAGS="-I/opt/homebrew/opt/mysql-client/include"
        # export PKG_CONFIG_PATH="/opt/homebrew/opt/mysql-client/lib/pkgconfig"
elif [[ "$OSTYPE" == "linux"* ]]; then
    echo
fi

# fuzzy-find
# -----------------------------------------------------------------------------

# export FZF_BASE="/usr/local/bin/fzf"

# determine search program for fzf
if type ag &> /dev/null; then
    export FZF_DEFAULT_COMMAND='ag -p ~/.gitignore -g ""'
fi                                  # NOTE: ^ nice!
# prefer rg over ag
if type rg &> /dev/null; then
    export FZF_DEFAULT_COMMAND='rg --files --hidden'
fi


# VARIOUS
# =============================================================================

# emsdk  (TODO needed?)
source $CONF/emsdk/emsdk_env.sh 2> /dev/null  # source quietly

if [[ "$OSTYPE" == "darwin"* ]]; then
    eval $(/opt/homebrew/bin/brew shellenv)    # needed for brew
    export PATH=$PATH:/opt/local/bin           # needed for macports
elif [[ "$OSTYPE" == "linux"* ]]; then
    export XINITRC="$CONF/x/.xinitrc"
fi

# export VIMRUNTIME="$HOME/.config/nvim/"

# latex (not working)
# if [ "$OS" = "macOS" ]; then
#     PATH=/usr/local/texlive/2019/bin/x86_64-darwin:"${PATH}"
# fi

